# Аутентификация

Аутентификация – это процедура проверки подлинности пользователя путём сравнения введённого пароля с паролем, хранящимся в базе данных. В этом упражнении мы будем использовать базовую аутентификацию.

## Ссылки

* [Урок по базовой аутентификации](https://ru.hexlet.io/courses/http_protocol/lessons/basic_auth/theory_unit)
* [Пример настройки базовой аутентификации](https://www.baeldung.com/java-config-spring-security#HTTP=)
* [Пример простого приложения Spring Boot с аутентификацией](https://spring.io/guides/gs/securing-web/)
* [Класс User, реализующий интерфейс UserDetails](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/User.html#<init>(java.lang.String,java.lang.String,java.util.Collection))
* [Кодировщик для хеширования пароля пользователя](https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/password/PasswordEncoder.html)
* [Метод antMathers() – определяет доступ к маршруту](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/AbstractRequestMatcherRegistry.html#antMatchers(org.springframework.http.HttpMethod,java.lang.String...))

## src/main/java/exercise/model/User.java

## Задачи

* Изучите модель пользователя в классе `User`. Обратите внимание на свойство `password`. В этом поле в базе будет храниться пароль пользователя. В целях безопасности пароль в базе данных хранится в зашифрованном виде.

## src/main/java/exercise/repository/UserRepository.java

Чтобы сравнить введенный пароль с паролем пользователя в базе данных, нам нужно будет найти пользователя по его `username`.

## Задачи

* Создайте в репозитории метод, который позволит найти в базе данных пользователя по его имени.

## src/main/java/exercise/UserDetailsServiceImpl.java

Далее мы должны указать, где найти информацию, необходимую для аутентификации. Интерфейс `UserDetailsService` содержит единственный метод `loadUserByUsername()`, который получает пользователя по его `username`. Этот метод мы должны переопределить.

## Задачи

* Допишите метод `loadUserByUsername()`. Метод должен находить в репозитории пользователя по его имени. Если пользователь не существует, должно быть выброшено исключение `UserNotFoundException`. Метод должен вернуть запись пользователя – объект класса `org.springframework.security.core.userdetails.User`, который реализует интерфейс `UserDetails`.

## src/main/java/exercise/WebSecurityConfig.java

Следующий шаг – создание конфигурации безопасности. По умолчанию Spring Security устанавливает дефолтные имя пользователя и пароль. Но нам нужно, чтобы пользователи использовали собственное имя и пароли для аутентификации. Поэтому нужно переопределить метод `configure()`, заменив дефолтную конфигурацию. Этот метод определяет, какие маршруты должны быть защищены, а какие нет.

## Задачи

* Допишите содержимое метода `configure()`. Укажите, что доступ к корню сайта */* не требует аутентификации, а все остальные маршруты должны требовать аутентификации. Укажите, что мы будем использовать базовую аутентификацию.

* Запустите приложение и откройте корневую страницу при помощи браузера. Убедитесь, что запрос по пути */* не требует аутентификации, а доступ к странице просмотра всех пользователей */users* требует имя пользователя и пароль.

* Пройдите аутентификацию, используя имя и пароль пользователя, который добавляется в базу при старте приложения. Имя и пароль можно узнать в файле *src/main/resorces/import.sql*

## src/main/java/exercise/controller/UserController.java

* Создайте в контроллере метод, который обрабатывает POST запросы на адрес */users* и регистрирует нового пользователя. Данные приходят в виде JSON:

  ```json
  {
      "username": "Petr",
      "email": "petr@gmail.com",
      "password": "123456"
  }
  ```

  Пароль пользователя должен храниться в базе данных в зашифрованном виде. Для этого перед тем, как сохранить его в базу, пароль нужно хешировать.

* Нам нужно разрешить регистрацию всем пользователям. Дополните конфигурацию в файле *src/main/java/exercise/WebSecurityConfig.java* Укажите, что выполнить POST запрос на адрес */users* могут все пользователи, в том числе и не авторизованные.

* Снова запустите приложение и создайте нового пользователя. Попробуйте авторизоваться, используя имя и пароль только что созданного пользователя.

## Деплой

## Задачи

* Выполните деплой получившегося приложения.

* Откройте задеплоенное приложение в браузере и убедитесь, что оно работает

## Подсказки

* Для дополнительной информации по работе приложения изучите файл с тестами.

* Чтобы выполнить запрос при помощи Postman к странице, требующей авторизации, вам понадобится установить в запрос заголовок `Authorization: Basic aHR0cHdhdGNoDmY=`. Здесь строка 'aHR0cHdhdGNoDmY=' – это имя пользователя и пароль в формате `usermane:password`, закодированные в base64
